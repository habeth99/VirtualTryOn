let injected=!1,currentTabId=null;chrome.tabs.onUpdated.addListener((e=>{e===currentTabId&&(injected=!1,currentTabId=null)})),chrome.action.onClicked.addListener((async e=>{if(console.log("Extension clicked, current state:",{injected,currentTabId}),injected)return await chrome.scripting.executeScript({target:{tabId:e.id},function:()=>{const e=document.getElementById("fashion-tryon-sidebar"),n=document.getElementById("fashion-tryon-drag-handle");e&&e.remove(),n&&n.remove()}}),injected=!1,void(currentTabId=null);await chrome.scripting.insertCSS({target:{tabId:e.id},css:"\n      #fashion-tryon-sidebar {\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        width: 400px;\n        height: 770px;\n        border: none;\n        border-radius: 8px;\n        box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n        z-index: 2147483647;\n        background: #2C3333;\n        overflow: hidden;\n      }\n      \n      #fashion-tryon-drag-handle {\n        position: fixed;\n        cursor: move;\n        user-select: none;\n        background: transparent;\n        z-index: 2147483648;\n      }\n    "}),await chrome.scripting.executeScript({target:{tabId:e.id},function:()=>{const e=document.createElement("iframe");e.id="fashion-tryon-sidebar",e.src=chrome.runtime.getURL("popup.html"),document.body.appendChild(e);const n=document.createElement("div");n.id="fashion-tryon-drag-handle",document.body.appendChild(n),window.addEventListener("message",(e=>{if("closeExtension"===e.data){const e=document.getElementById("fashion-tryon-sidebar"),n=document.getElementById("fashion-tryon-drag-handle");e&&e.remove(),n&&n.remove(),chrome.runtime.sendMessage({action:"extensionClosed"})}}));let t,d,o,i,r=!1,a=20,c=20;const s=()=>{n.style.left=`${a}px`,n.style.top=`${c}px`,n.style.width="340px",n.style.height="40px",e.style.left=`${a}px`,e.style.top=`${c}px`};n.addEventListener("mousedown",(e=>{e.clientX-a>340||(o=e.clientX-a,i=e.clientY-c,e.target===n&&(r=!0))})),document.addEventListener("mousemove",(e=>{r&&(e.preventDefault(),t=e.clientX-o,d=e.clientY-i,a=t,c=d,s())})),document.addEventListener("mouseup",(()=>{r=!1})),s()}}),injected=!0,currentTabId=e.id})),chrome.runtime.onMessage.addListener((e=>{"extensionClosed"===e.action&&(injected=!1,currentTabId=null)})),chrome.windows.onRemoved.addListener((e=>{e===windowId&&(windowId=null)}));