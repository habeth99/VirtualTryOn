let injected=!1,currentTabId=null;chrome.runtime.onMessage.addListener((e=>{"windowClosed"===e.action&&(injected=!1,currentTabId=null)})),chrome.action.onClicked.addListener((async e=>{if(currentTabId===e.id)return await chrome.scripting.executeScript({target:{tabId:e.id},function:()=>{const e=document.getElementById("fashion-tryon-sidebar"),n=document.getElementById("fashion-tryon-drag-handle");e&&e.remove(),n&&n.remove()}}),injected=!1,void(currentTabId=null);currentTabId&&await chrome.scripting.executeScript({target:{tabId:currentTabId},function:()=>{const e=document.getElementById("fashion-tryon-sidebar"),n=document.getElementById("fashion-tryon-drag-handle");e&&e.remove(),n&&n.remove()}}),currentTabId=e.id,injected=!0,await chrome.scripting.insertCSS({target:{tabId:e.id},css:"\n      #fashion-tryon-sidebar {\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        width: 400px;\n        height: 650px;\n        border: none;\n        border-radius: 8px;\n        box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n        z-index: 2147483647;\n        background: #2C3333;  /* Charcoal color */\n        overflow: hidden;\n      }\n      \n      #fashion-tryon-drag-handle {\n        position: fixed;\n        cursor: move;\n        user-select: none;\n        background: transparent;\n        z-index: 2147483648;\n      }\n    "}),await chrome.scripting.executeScript({target:{tabId:e.id},function:()=>{const e=document.createElement("iframe");e.id="fashion-tryon-sidebar",e.src=chrome.runtime.getURL("popup.html"),document.body.appendChild(e);const n=document.createElement("div");n.id="fashion-tryon-drag-handle",document.body.appendChild(n);let t,d,o,r,i=!1,a=20,c=20;const s=()=>{n.style.left=`${a}px`,n.style.top=`${c}px`,n.style.width="340px",n.style.height="40px",n.style.marginRight="60px",e.style.left=`${a}px`,e.style.top=`${c}px`};n.addEventListener("mousedown",(e=>{e.clientX-a>340||(o=e.clientX-a,r=e.clientY-c,e.target===n&&(i=!0))})),document.addEventListener("mousemove",(e=>{i&&(e.preventDefault(),t=e.clientX-o,d=e.clientY-r,a=t,c=d,s())})),document.addEventListener("mouseup",(()=>{i=!1})),s(),window.addEventListener("message",(e=>{if("closeExtension"===e.data){const e=document.getElementById("fashion-tryon-sidebar"),n=document.getElementById("fashion-tryon-drag-handle");e&&e.remove(),n&&n.remove(),injected=!1,currentTabId=null}}))}})})),chrome.windows.onRemoved.addListener((e=>{e===windowId&&(windowId=null)}));